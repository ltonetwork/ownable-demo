<!doctype html>

<html>
    <body>
        <script>
            async function test() {
                // TODO: import another wasm file and try to pass it as importObject
                // const response = await fetch("./target/wasm32-unknown-unknown/debug/wasm_deno_example.wasm");
                // const wasmCode = await response.arrayBuffer();
                // const wasmModule = new WebAssembly.Module(wasmCode);
                // const wasmInstance = new WebAssembly.Instance(wasmModule);

                var importObject = { imports: {
                        imported_func: arg => console.log(`imported func: ${arg}`),
                        add_five: arg => {
                            console.log(`received arg: ${arg}`);
                            return arg + 5;
                        },
                    },
                };

                WebAssembly.instantiateStreaming(
                    fetch('./target/wasm32-unknown-unknown/debug/wasm_playground.wasm'),
                    importObject
                ).then(wasm_binary => {
                    // const age = wasm_binary.instance.exports.age(2020, 1994);
                    // console.log(`age: ${age}`);
                    console.log(wasm_binary);
                    // calls imported_func
                    console.log(wasm_binary.instance.exports);
                    wasm_binary.instance.exports.exported_func(5);
                    wasm_binary.instance.exports.imported_add_five(10);
                });
            }

            test()
        </script>
    </body>
</html>